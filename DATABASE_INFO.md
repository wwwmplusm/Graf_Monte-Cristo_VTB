# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

## –°–±—Ä–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
```bash
python3 reset_database.py
```

### –ë—ã—Å—Ç—Ä—ã–π —Å–±—Ä–æ—Å (–±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
```bash
./reset_db_quick.sh
```

## –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å–µ–Ω—Ç–∞–º–∏ —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —Å—Ä–æ–∫–∞

**–¢–∞–±–ª–∏—Ü–∞**: `consents`  
**–ù–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞**: `expires_at` (TEXT, ISO datetime)

- –í—Å–µ –∫–æ–Ω—Å–µ–Ω—Ç—ã —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç –¥–∞—Ç—É –∏—Å—Ç–µ—á–µ–Ω–∏—è
- OBR –∫–ª–∏–µ–Ω—Ç –ø–∞—Ä—Å–∏—Ç `expirationDateTime` –∏–∑ –æ—Ç–≤–µ—Ç–æ–≤ –±–∞–Ω–∫–æ–≤
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞

### 2. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞**: `bank_data_cache`

| –ö–æ–ª–æ–Ω–∫–∞     | –¢–∏–ø  | –û–ø–∏—Å–∞–Ω–∏–µ                                    |
|-------------|------|---------------------------------------------|
| user_id     | TEXT | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (PK)                        |
| bank_id     | TEXT | ID –±–∞–Ω–∫–∞ (PK)                               |
| data_type   | TEXT | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: accounts/balances/transactions/credits (PK) |
| data_json   | TEXT | JSON —Å –¥–∞–Ω–Ω—ã–º–∏                              |
| fetched_at  | TEXT | ISO timestamp –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö               |

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã**:
- `bootstrap_bank()` —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–µ—à (–µ—Å–ª–∏ `use_cache=True`)
- –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑ –∫–µ—à–∞
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –±–∞–Ω–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –∫–µ—à

### 3. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–µ—Å—Ç–∏ –≤ Dashboard

**Backend schema**: `DataFreshness`
```python
{
    "bank_id": str,
    "fetched_at": str,  # ISO timestamp
    "age_minutes": int   # –í–æ–∑—Ä–∞—Å—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –º–∏–Ω—É—Ç–∞—Ö
}
```

**Dashboard Response**:
- –¢–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç –º–∞—Å—Å–∏–≤ `data_freshness: List[DataFreshness]`
- Analytics —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–µ—Å—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ –±–∞–Ω–∫–∞

### 4. UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–≤–µ–∂–µ—Å—Ç–∏

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `DataFreshnessIndicator.tsx`

–¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è:
- üü¢ –ó–µ–ª–µ–Ω—ã–π: < 5 –º–∏–Ω—É—Ç
- üü° –ñ–µ–ª—Ç—ã–π: < 30 –º–∏–Ω—É—Ç  
- ‚ö™ –°–µ—Ä—ã–π: > 30 –º–∏–Ω—É—Ç

–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ HomeScreen –ø–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ pending –∫–æ–Ω—Å–µ–Ω—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –∑–∞–≤–∏—Å–∞–ª –ø–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ–Ω—Å–µ–Ω—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±–∞–Ω–∫–∞.

**–†–µ—à–µ–Ω–∏–µ**: –í `get_consents_status()` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É –±–∞–Ω–∫–∞ –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Å–µ–Ω—Ç–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `"AWAITING_USER"`:

```python
if status == "AWAITING_USER" and request_id:
    poll_result = await poll_consent_status(user_id, bank_id, request_id)
    if poll_result.get("state") == "approved":
        status = "APPROVED"
```

Frontend polling (–∫–∞–∂–¥—ã–µ 2.5 —Å–µ–∫) —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –∫–æ–Ω—Å–µ–Ω—Ç—ã.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

```bash
# –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
sqlite3 finpulse_consents.db ".tables"

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã consents
sqlite3 finpulse_consents.db "PRAGMA table_info(consents);"

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã bank_data_cache
sqlite3 finpulse_consents.db "PRAGMA table_info(bank_data_cache);"

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ë–î –ø—É—Å—Ç–∞—è
sqlite3 finpulse_consents.db "SELECT COUNT(*) FROM consents;"
```

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–±—Ä–æ—à–µ–Ω–∞  
‚úÖ –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —Å –Ω–æ–≤–æ–π —Å—Ö–µ–º–æ–π  
‚úÖ –ö–æ–ª–æ–Ω–∫–∞ `expires_at` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `consents`  
‚úÖ –¢–∞–±–ª–∏—Ü–∞ `bank_data_cache` —Å–æ–∑–¥–∞–Ω–∞  
‚úÖ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö (—á–∏—Å—Ç–∞—è –ë–î)  
‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å –Ω—É–ª—è

